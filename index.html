<!DOCTYPE html>
<html>
    <head>
        <title>Asset "{{ ASSET_NAME }}"</title>
        <link rel="stylesheet" href="styles.css"/>
        <link rel="icon" href="images/favicon.png"/>
    </head>
    <body>
        <h1 class="asset_title">{{ ASSET_NAME_ID }}</h1>
        <h1 class="asset_moderated_message" hidden>Asset is private, archived, or has been moderated</h1>
        <canvas id="visualizer"></canvas>
        <div id="mediaPlayerControls">
            <audio id="playable" src="{{ CACHE_SOURCE }}" hidden></audio>
            <div id="picture"></div>
            <div id="icon_playpause" class="media_icon icon_play"></div>
            <input id="slider_time" type="range" value="0"/>
        </div>
        <script>
            window.addEventListener("load",function(ev){
                var media_icon=document.getElementById("icon_playpause");
                var durationSlider=document.getElementById("slider_time");
                var theaudio=document.getElementById("playable");
                var canvas=document.getElementById("visualizer");
                var isPlay=false;
                theaudio.addEventListener("timeupdate", function() {
                    durationSlider.value=theaudio.currentTime;
                    durationSlider.max=theaudio.duration;
                });
                durationSlider.addEventListener("change", function() {
                    theaudio.currentTime=durationSlider.value;
                });
                theaudio.addEventListener("pause",function(ev){
                    isPlay=false;
                    media_icon.className="media_icon icon_play";
                });
                theaudio.addEventListener("play",function(ev){
                    isPlay=true;
                    media_icon.className="media_icon icon_pause";
                });
                media_icon.addEventListener("click",function(ev){
                    if (isPlay) {
                        isPlay=false;
                        media_icon.className="media_icon icon_play";
                        theaudio.pause();
                    }else{
                        isPlay=true;
                        media_icon.className="media_icon icon_pause";
                        theaudio.play();
                    };
                });
                function analyser_handler(){
                    var audioctx=new AudioContext();
                    var mediaSource=audioctx.createMediaElementSource(theaudio);
                    var analyser=new AnalyserNode(audioctx);
                    analyser.fftSize=128;
                    mediaSource.connect(analyser);
                    mediaSource.connect(audioctx.destination);
                };
            });
        </script>
    </body>
</html>